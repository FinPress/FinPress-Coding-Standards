#!/bin/bash
# Check to see that all rules in the standard are present in at least one of the
# ruleset subsets: Subsets/{Core,Extra,VIP}/ruleset.xml

cd "$(dirname $0)/.."

unassociated_count=0

for rule in $(find Sniffs -name '*.php' | sed 's:Sniff.php::' | sed 's:.*Sniffs/::' | sed 's:/:.:g'); do
	rule="WordPress.$rule"
	echo "$rule"
	rulesets=$(grep -l $rule Subsets/{Core,Extra,VIP}/ruleset.xml)
	if [ -z "$rulesets" ]; then
		unassociated_count=$(expr $unassociated_count + 1)
		echo " - FAIL"
	else
		for ruleset in "${rulesets[@]}"; do
			echo " + $ruleset"
		done
	fi
done

if [ $unassociated_count != 0 ]; then
	echo "Error: There are $unassociated_count rule(s) not associated with rulesets"
	exit 1
fi
